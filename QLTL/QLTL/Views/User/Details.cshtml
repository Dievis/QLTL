@model QLTL.ViewModels.UserVM.UserViewModel
@{
    ViewBag.Title = "Chi tiết người dùng";

    var canEdit = false;

    if (Session["IsSuperAdmin"] is bool isSuperAdmin && isSuperAdmin)
    {
        canEdit = true;
    }
    else if (Session["Permissions"] is List<string> perms)
    {
        canEdit = perms.Contains("User.Edit", StringComparer.OrdinalIgnoreCase);
    }
}

@section styles {
    <link href="~/Content/detail.css" rel="stylesheet" />
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">

            <div class="card shadow-sm detail-card">
                <div class="detail-header">
                    <h4 class="mb-0">
                        <i class="bi bi-person-badge-fill me-2"></i> Chi tiết người dùng
                    </h4>
                </div>
                <div class="card-body">

                    <dl class="row mb-0">
                        <dt class="col-sm-3 fw-bold">Tên đăng nhập</dt>
                        <dd class="col-sm-9">@Model.Username</dd>

                        <dt class="col-sm-3 fw-bold">Họ tên</dt>
                        <dd class="col-sm-9">@Model.FullName</dd>

                        <dt class="col-sm-3 fw-bold">Email</dt>
                        <dd class="col-sm-9">@Model.Email</dd>

                        <dt class="col-sm-3 fw-bold">Điện thoại</dt>
                        <dd class="col-sm-9">@Model.Phone</dd>

                        <dt class="col-sm-3 fw-bold">Phòng ban</dt>
                        <dd class="col-sm-9">@Model.DepartmentName</dd>

                        <dt class="col-sm-3 fw-bold">Trạng thái</dt>
                        <dd class="col-sm-9">
                            @if (Model.IsDeleted)
                            {
                                <span class="badge bg-danger">Đã xóa</span>
                            }
                            else
                            {
                                <span class="badge bg-success">Hoạt động</span>
                            }
                        </dd>

                        <dt class="col-sm-3 fw-bold">Ngày tạo</dt>
                        <dd class="col-sm-9">@Model.CreatedAt.ToString("dd/MM/yyyy")</dd>

                        @if (Model.UpdatedAt != null)
                        {
                            <dt class="col-sm-3 fw-bold">Ngày cập nhật</dt>
                            <dd class="col-sm-9">@Model.UpdatedAt.Value.ToString("dd/MM/yyyy")</dd>
                        }

                        <dt class="col-sm-3 fw-bold">Vai trò</dt>
                        <dd class="col-sm-9">
                            @if (Model.RoleNames != null && Model.RoleNames.Any())
                            {
                                foreach (var roleName in Model.RoleNames)
                                {
                                    <span class="badge role-badge me-1">@roleName</span>
                                }
                            }
                            else
                            {
                                <span class="text-muted">Chưa có vai trò</span>
                            }
                        </dd>

                    </dl>

                    <div class="d-flex justify-content-end mt-3">
                        <a href="@Url.Action("Edit", new { id = Model.UserId })" class="btn btn-warning me-2">
                            <i class="bi bi-pencil-square"></i> Sửa
                        </a>
                        <a href="@Url.Action("Index")" class="btn btn-secondary">
                            <i class="bi bi-arrow-left"></i> Quay lại
                        </a>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>
